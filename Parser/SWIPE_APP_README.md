# Swipe App (единая проверка объектов, только SALE)

## Что делает
Локальное веб-приложение показывает **одну карточку на объект**, объединяя данные из конкурентов:
- одна фотография объекта (берётся с любой доступной ссылки конкурента),
- адрес,
- район,
- проверка: есть ли этот адрес у нас в `deals.xml` + вывод наших ссылок для ручной проверки,
- единая таблица сравнения (и конкурент, и наша база в одном формате колонок),
- только сделки `sale`.

Используем конкурентов:
- `KNRU`
- `Северо-Запад`
- `Rest2Rent`

Очередь карточек отсортирована по приоритету:
- сначала объекты, которые есть у **2+ конкурентов** и при этом **отсутствуют у нас по адресу** (рубрика `а с хрена ли у нас нет`),
- затем объекты с рубрикой `неточное совпадение` (есть только похожая сделка у нас),
- затем объекты у 2+ конкурентов, где у нас объект есть, но **наша sale-цена выше** (рубрика `а схерали у нас дороже чем у конкурентов`),
- затем объекты у 2+ конкурентов, где адрес у нас найден,
- затем объекты, где хотя бы у одного конкурента позиция в топ-50%,
- затем «хвост» (позиции ниже 50% у всех источников).

В колонке позиции конкурентов:
- `< 10%` подсвечивается зелёным (свежее),
- `> 50%` подсвечивается красным (старое).

## Кнопки
- `← ай херня`
- `что ты мелишь, у нас есть этот объект - перепроверь`
- `о нормально →`

## Опросник
- Перед работой спрашивает: кто опросник (3 варианта: `Сашка`, `Дима`, `Саш`).
- Ответы и голосования сохраняются в SQLite.
- В интерфейсе видно, кто ответил сегодня и кого ещё ждём.
- На `о нормально`/`ай херня` озвучивается случайная фраза (через браузерный speech synthesis).

## Запуск
```bash
cd /Users/aleksandrarakceev/Desktop/Parser
python3 swipe_app.py --host 127.0.0.1 --port 8787
```

Открыть в браузере:
- <http://127.0.0.1:8787>

## Источники данных
Автоматически подхватываются последние CSV:
- `compare_report_*.csv` (KNRU)
- `compare_report_nordwest_*.csv`
- `compare_report_rest2rent_*.csv`

## Что сохраняется
- Голоса: `/Users/aleksandrarakceev/Desktop/Parser/swipe_votes_sale_union.csv`
- База опросника/голосований: `/Users/aleksandrarakceev/Desktop/Parser/swipe_poll.sqlite3`
- Кэш фото: `/Users/aleksandrarakceev/Desktop/Parser/swipe_photo_cache.json`

Фото теперь отдаются через локальный прокси `/api/photo`, чтобы обходить блокировки прямого hotlink с сайтов конкурентов.
Если фото не найдено, в карточке есть кнопка перехода в карту/панораму (поиск по адресу в Яндекс Картах).
