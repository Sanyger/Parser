import { hashPassword } from '../lib/auth';
import { buildTranslations } from '../lib/translation';
import { DatabaseSnapshot, Message } from '../types/models';

const PASSWORD = hashPassword('1234');

function makeMessage(message: Omit<Message, 'translations'>): Message {
  return {
    ...message,
    translations: buildTranslations(message.text_original, message.lang_original),
  };
}

const seed: DatabaseSnapshot = {
  school: {
    id: 'school_1',
    name: 'Школьный кабинет Израиль (прототип)',
    timezone: 'Asia/Jerusalem',
    enabled_languages: ['he', 'ru', 'en'],
    auto_translate_enabled: true,
  },
  users: [
    {
      id: 'user_director_1',
      name: 'Татьяна',
      login: 'director1',
      password_hash: PASSWORD,
      role_id: 1,
      preferred_language: 'ru',
      is_homeroom: false,
      class_ids: ['class_g1'],
      child_ids: [],
      is_active: true,
    },
    {
      id: 'user_teacher_1',
      name: 'Инна',
      login: 'teacher1',
      password_hash: PASSWORD,
      role_id: 3,
      preferred_language: 'ru',
      is_homeroom: false,
      class_ids: ['class_g1'],
      child_ids: [],
      is_active: true,
    },
    {
      id: 'user_parent_1',
      name: 'Аракчеев Александр',
      login: 'parent1',
      password_hash: PASSWORD,
      role_id: 4,
      preferred_language: 'ru',
      is_homeroom: false,
      class_ids: ['class_g1'],
      child_ids: ['user_student_1'],
      is_active: true,
    },
    {
      id: 'user_student_1',
      name: 'Марк Аракчеев',
      login: 'student1',
      password_hash: PASSWORD,
      role_id: 5,
      preferred_language: 'ru',
      is_homeroom: false,
      class_ids: ['class_g1'],
      child_ids: [],
      is_active: true,
    },
    {
      id: 'user_staff_1',
      name: 'Сара',
      login: 'staff1',
      password_hash: PASSWORD,
      role_id: 6,
      preferred_language: 'ru',
      is_homeroom: false,
      class_ids: ['class_g1'],
      child_ids: [],
      is_active: true,
    },
  ],
  classes: [
    {
      id: 'class_g1',
      name: 'Класс 3-1',
      grade: '3',
      homeroom_teacher_id: null,
    },
  ],
  lessons: [
    {
      id: 'lesson_sun_1',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Иврит',
      room: '201',
      start_datetime: '2026-02-22T06:00:00.000Z',
      end_datetime: '2026-02-22T06:50:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_sun_2',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Математика',
      room: '201',
      start_datetime: '2026-02-22T06:50:00.000Z',
      end_datetime: '2026-02-22T07:40:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_sun_3',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Естествознание',
      room: 'Лаборатория 1',
      start_datetime: '2026-02-22T08:05:00.000Z',
      end_datetime: '2026-02-22T08:50:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_mon_1',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'История',
      room: '203',
      start_datetime: '2026-02-23T06:00:00.000Z',
      end_datetime: '2026-02-23T06:50:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_mon_2_old',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Математика',
      room: '201',
      start_datetime: '2026-02-23T06:50:00.000Z',
      end_datetime: '2026-02-23T07:40:00.000Z',
      type: 'lesson',
      status: 'canceled',
      original_reference_id: null,
      change_reason: 'Учитель заболел. Урок заменён занятием по робототехнике.',
    },
    {
      id: 'lesson_mon_2_new',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Робототехника',
      room: 'Технический кабинет',
      start_datetime: '2026-02-23T06:50:00.000Z',
      end_datetime: '2026-02-23T07:40:00.000Z',
      type: 'lesson',
      status: 'changed',
      original_reference_id: 'lesson_mon_2_old',
      change_reason: 'Учитель заболел. Урок заменён занятием по робототехнике.',
    },
    {
      id: 'lesson_mon_3',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Английский язык',
      room: '204',
      start_datetime: '2026-02-23T08:05:00.000Z',
      end_datetime: '2026-02-23T08:50:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_tue_1',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Иврит',
      room: '201',
      start_datetime: '2026-02-24T06:00:00.000Z',
      end_datetime: '2026-02-24T06:50:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_tue_2',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'ИЗО',
      room: 'Студия',
      start_datetime: '2026-02-24T06:50:00.000Z',
      end_datetime: '2026-02-24T07:40:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_tue_3',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Физкультура',
      room: 'Спортзал',
      start_datetime: '2026-02-24T08:05:00.000Z',
      end_datetime: '2026-02-24T08:50:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_wed_1',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Математика',
      room: '201',
      start_datetime: '2026-02-25T06:00:00.000Z',
      end_datetime: '2026-02-25T06:50:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_wed_2',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'География',
      room: '203',
      start_datetime: '2026-02-25T06:50:00.000Z',
      end_datetime: '2026-02-25T07:40:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_wed_3',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Информатика',
      room: 'Кабинет информатики 2',
      start_datetime: '2026-02-25T08:05:00.000Z',
      end_datetime: '2026-02-25T08:50:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_thu_1',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Английский язык',
      room: '204',
      start_datetime: '2026-02-26T06:00:00.000Z',
      end_datetime: '2026-02-26T06:50:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_thu_2',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'История',
      room: '203',
      start_datetime: '2026-02-26T06:50:00.000Z',
      end_datetime: '2026-02-26T07:40:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_thu_3',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Музыка',
      room: 'Музыкальный зал',
      start_datetime: '2026-02-26T08:05:00.000Z',
      end_datetime: '2026-02-26T08:50:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_fri_1',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Общая линейка',
      room: 'Актовый зал',
      start_datetime: '2026-02-27T06:00:00.000Z',
      end_datetime: '2026-02-27T06:50:00.000Z',
      type: 'requirement',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_fri_2',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'Классное мероприятие: подготовка к шаббату',
      room: 'Класс',
      start_datetime: '2026-02-27T06:50:00.000Z',
      end_datetime: '2026-02-27T07:40:00.000Z',
      type: 'event',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
    {
      id: 'lesson_fri_3',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      subject: 'ИЗО',
      room: 'Студия',
      start_datetime: '2026-02-27T08:05:00.000Z',
      end_datetime: '2026-02-27T08:50:00.000Z',
      type: 'lesson',
      status: 'normal',
      original_reference_id: null,
      change_reason: null,
    },
  ],
  homework: [
    {
      id: 'hw_1',
      lesson_id: 'lesson_sun_1',
      class_id: 'class_g1',
      teacher_id: 'user_teacher_1',
      text: 'Прочитать страницу 12 и ответить на вопросы.',
      attachments: [],
      source: 'manual',
      ocr_raw_text: null,
      created_at: '2026-02-22T10:00:00.000Z',
      updated_at: '2026-02-22T10:00:00.000Z',
    },
  ],
  threads: [
    {
      id: 'thread_parent_teacher_1',
      type: 'parent_teacher',
      participants: ['user_teacher_1', 'user_parent_1'],
      class_id: 'class_g1',
    },
    {
      id: 'thread_class_announcement_1',
      type: 'class',
      participants: ['user_teacher_1', 'user_parent_1', 'user_student_1', 'user_director_1', 'user_staff_1'],
      class_id: 'class_g1',
    },
    {
      id: 'thread_director_all',
      type: 'announcement',
      participants: ['user_director_1', 'user_teacher_1', 'user_parent_1', 'user_student_1', 'user_staff_1'],
      class_id: null,
    },
  ],
  messages: [
    makeMessage({
      id: 'msg_1',
      thread_id: 'thread_parent_teacher_1',
      sender_id: 'user_parent_1',
      text_original: 'Здравствуйте, Марк будет отсутствовать на первом уроке завтра.',
      lang_original: 'ru',
      attachments: [],
      created_at: '2026-02-22T12:10:00.000Z',
      read_by: ['user_parent_1'],
    }),
    makeMessage({
      id: 'msg_2',
      thread_id: 'thread_parent_teacher_1',
      sender_id: 'user_teacher_1',
      text_original: 'Спасибо за уведомление. Отметила в журнале.',
      lang_original: 'ru',
      attachments: [],
      created_at: '2026-02-22T12:20:00.000Z',
      read_by: ['user_teacher_1'],
    }),
    makeMessage({
      id: 'msg_3',
      thread_id: 'thread_director_all',
      sender_id: 'user_director_1',
      text_original: 'Добро пожаловать в новый школьный сервис-прототип.',
      lang_original: 'ru',
      attachments: [],
      created_at: '2026-02-22T07:00:00.000Z',
      read_by: ['user_director_1'],
    }),
  ],
  feedback: [
    {
      id: 'feedback_1',
      author_id: 'user_parent_1',
      visibility_roles: [1, 2, 3],
      is_private_to_author: false,
      text_original: 'Хотелось бы больше проектов по робототехнике.',
      translations: buildTranslations('Хотелось бы больше проектов по робототехнике.', 'ru'),
      status: 'new',
    },
    {
      id: 'feedback_2',
      author_id: 'user_parent_1',
      visibility_roles: [1],
      is_private_to_author: true,
      text_original: 'Личное замечание директору.',
      translations: buildTranslations('Личное замечание директору.', 'ru'),
      status: 'new',
    },
  ],
  absence: [],
  extra_classes: [
    {
      id: 'extra_1',
      title: 'Кружок робототехники',
      description: 'Занятие по робототехнике после уроков',
      datetime: '2026-02-24T13:00:00.000Z',
      max_slots: 20,
    },
  ],
  signups: [
    {
      id: 'signup_1',
      extra_class_id: 'extra_1',
      student_id: 'user_student_1',
      status: 'approved',
    },
  ],
};

export function createSeedDatabase(): DatabaseSnapshot {
  return JSON.parse(JSON.stringify(seed)) as DatabaseSnapshot;
}
